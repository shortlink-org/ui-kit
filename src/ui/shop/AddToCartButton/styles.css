/**
 * Add to Cart Button component styles
 * 
 * Uses CSS @layer for cascade control and @scope for style isolation.
 * Layer order: base → component → state → animation
 */

/* Define layer order for this component */
@layer atc.base, atc.component, atc.state, atc.animation;

/* Base layer: CSS custom properties */
@layer atc.base {
  @property --complete {
    initial-value: 0;
    inherits: true;
    syntax: '<number>';
  }
}

/* Component layer: Core component styles with @scope isolation */
@layer atc.component {
  @scope ([data-component="add-to-cart"]) {
    /* Wrapper */
    :scope {
      scale: var(--scale, 1);
      position: relative;
    }

    /* Main button */
    [data-atc-button] {
      user-select: none;
      -webkit-tap-highlight-color: #0000;
      position: relative;
      border-radius: 9999px;
      color: color-mix(in hsl, canvasText, canvas 10%);
      font-weight: 300;
      font-size: 0.875rem;
      padding: 0;
      border: 2px solid color-mix(in hsl, canvasText, canvas 90%);
      cursor: pointer;
      background: light-dark(#fff, #000);
      white-space: nowrap;
    }

    /* Content area */
    [data-atc-content] {
      display: flex;
      align-items: center;
      overflow: hidden;
      gap: 0.375rem;
      padding: 0.5rem 1.25rem;
      padding-right: 1.5rem;
      border-radius: inherit;
      position: relative;
      z-index: 2;
      white-space: nowrap;
    }

    [data-atc-content]::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      background: light-dark(#fff, #000);
      opacity: 1;
      z-index: -1;
    }

    /* Cart icon container */
    [data-atc-cart] {
      display: inline-block;
      width: 20px;
      height: 20px;
      transform-origin: 0 100%;
    }

    [data-atc-cart-dummy] {
      display: inline-block;
      width: 20px;
      height: 20px;
      position: absolute;
      left: 50%;
      top: 50%;
      opacity: 0;
      translate: -50% -50%;
    }

    /* Check icon */
    [data-atc-check] {
      display: inline-block;
      width: 20px;
      height: 20px;
      position: absolute;
      left: 50%;
      top: 50%;
      opacity: 0;
      translate: -50% -50%;
      stroke: hsl(140 90% 50%);
    }

    /* Cart fill color */
    [data-atc-cart-content] {
      fill: hsl(140 90% 50%);
    }

    /* Icon sizing */
    [data-atc-icon] {
      overflow: visible !important;
      width: 100%;
      height: 100%;
    }

    /* Button text */
    [data-atc-text] {
      font-size: 0.875rem;
    }

    /* Border effects base */
    [data-atc-border] {
      position: absolute;
      inset: -2px;
      container-type: inline-size;
      border: 2px solid transparent;
      mask:
        linear-gradient(#fff 0 0) padding-box,
        linear-gradient(#fff 0 0) border-box;
      mask-composite: exclude;
      border-radius: inherit;
    }

    /* Demo border (loading indicator background) */
    [data-atc-border][data-border-type="demo"] {
      mask: unset;
      position: absolute;
      z-index: -1;
      opacity: 0;
    }

    [data-atc-border][data-border-type="demo"]::before {
      content: '';
      width: calc(100cqi + 4px);
      height: calc(100cqi + 4px);
      position: absolute;
      top: 50%;
      left: 50%;
      translate: -50% -50%;
      border-radius: inherit;
      background: light-dark(#fff, #000);
      opacity: 0.75;
      z-index: 2;
    }

    /* Static border */
    [data-atc-border][data-border-type="static"] {
      opacity: 0;
      border-color: canvasText;
    }

    /* Complete border (success state) */
    [data-atc-border][data-border-type="complete"] {
      border-color: hsl(140 90% 50%);
      opacity: 0;
    }

    /* Animated gradient border */
    [data-atc-border][data-border-type="animated"]::after {
      content: '';
      width: calc(100cqi + 4px);
      height: calc(100cqi + 4px);
      background: conic-gradient(
        from calc(var(--complete, 0) * 180deg) in hsl increasing hue,
        #0000 0 calc((1 - var(--complete)) * 20%),
        hsl(0 100% 65%) calc((1 - var(--complete)) * 30%),
        hsl(339 100% 65%) calc(100% - ((1 - var(--complete)) * 30%)),
        #0000 calc(100% - ((1 - var(--complete)) * 20%)) 100%
      );
      position: absolute;
      top: 50%;
      left: 50%;
      translate: -50% -50%;
      z-index: -1;
    }
  }
}

/* State layer: Interactive states */
@layer atc.state {
  @scope ([data-component="add-to-cart"]) {
    /* Active press state */
    [data-atc-button][data-adding="false"]:active {
      translate: 0 1px;
      scale: 0.99;
    }

    /* Reveal state */
    :scope[data-reveal="true"] [data-atc-content]::before {
      opacity: 0.75;
    }

    :scope[data-reveal="true"] [data-atc-border][data-border-type="demo"] {
      opacity: 1;
    }

    :scope[data-reveal="true"] [data-atc-border][data-border-type="animated"]:not([data-border-type="demo"]) {
      mask:
        linear-gradient(#ffffff50 0 0) padding-box,
        linear-gradient(#fff 0 0) border-box;
    }

    /* Complete state */
    :scope[data-complete="true"] [data-atc-border][data-border-type="animated"]::after {
      --complete: 1;
    }
  }
}

/* Animation layer: Transitions and keyframes */
@layer atc.animation {
  @scope ([data-component="add-to-cart"]) {
    /* Button transitions */
    [data-atc-button] {
      transition-property: translate, scale;
      transition-duration: 0.16s;
      transition-timing-function: ease-out;
    }

    /* Content transitions */
    [data-atc-content] {
      transition: opacity 0.26s ease-out;
    }

    [data-atc-content]::before {
      transition: opacity 0.26s ease-out;
    }

    /* Border transitions */
    [data-atc-border][data-border-type="demo"] {
      transition: opacity 0.26s ease-out;
    }

    [data-atc-border][data-border-type="animated"]::after {
      transition: --complete 0.22s ease-out;
    }

    /* Spin animation for borders */
    [data-atc-border][data-border-type="demo"]::before,
    [data-atc-border][data-border-type="animated"]::after {
      animation: atc-spin 2s infinite linear;
    }

    @keyframes atc-spin {
      to {
        rotate: 360deg;
      }
    }
  }

  /* Respect reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    @scope ([data-component="add-to-cart"]) {
      [data-atc-button] {
        transition: none;
      }

      [data-atc-content],
      [data-atc-content]::before,
      [data-atc-border][data-border-type="demo"],
      [data-atc-border][data-border-type="animated"]::after {
        transition: none;
      }

      [data-atc-border][data-border-type="demo"]::before,
      [data-atc-border][data-border-type="animated"]::after {
        animation: none;
      }
    }
  }
}

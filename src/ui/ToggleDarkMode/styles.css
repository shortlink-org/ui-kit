/**
 * Toggle Dark Mode component styles
 * 
 * Uses CSS @layer for cascade control and @scope for style isolation.
 * Layer order: base → component → state → animation
 */

/* Define layer order for this component */
@layer toggle.base, toggle.component, toggle.state, toggle.animation;

/* Base layer: Component wrapper and accessibility */
@layer toggle.base {
  @scope ([data-component="toggle-dark-mode"]) {
    /* Wrapper */
    :scope {
      display: inline-block;
      overflow: hidden;
    }

    /* Hidden input - accessible but visually hidden */
    input {
      position: absolute;
      left: -99em;
    }
  }
}

/* Component layer: Core visual styles */
@layer toggle.component {
  @scope ([data-component="toggle-dark-mode"]) {
    /* Toggle track */
    [data-toggle-track] {
      cursor: pointer;
      display: inline-block;
      position: relative;
      width: 90px;
      height: 50px;
      background-color: #83d8ff;
      border-radius: 84px;
    }

    [data-toggle-track]::before {
      content: '';
      position: absolute;
      left: -50px;
      top: 15px;
      font-size: 18px;
    }

    [data-toggle-track]::after {
      content: '';
      position: absolute;
      right: -48px;
      top: 15px;
      font-size: 18px;
      color: #749ed7;
    }

    /* Toggle handler (sun/moon) */
    [data-toggle-handler] {
      display: inline-block;
      position: relative;
      z-index: 1;
      top: 3px;
      left: 3px;
      width: 44px;
      height: 44px;
      background-color: #ffcf96;
      border-radius: 50px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      transform: rotate(-45deg);
    }

    /* Moon craters */
    [data-crater] {
      position: absolute;
      background-color: #e8cda5;
      opacity: 0;
      border-radius: 100%;
    }

    [data-crater="1"] {
      top: 18px;
      left: 10px;
      width: 4px;
      height: 4px;
    }

    [data-crater="2"] {
      top: 28px;
      left: 22px;
      width: 6px;
      height: 6px;
    }

    [data-crater="3"] {
      top: 10px;
      left: 25px;
      width: 8px;
      height: 8px;
    }

    /* Stars/Clouds - light mode (clouds) */
    [data-star] {
      position: absolute;
      background-color: #ffffff;
      border-radius: 50%;
    }

    [data-star="1"] {
      top: 10px;
      left: 35px;
      z-index: 0;
      width: 30px;
      height: 3px;
    }

    [data-star="2"] {
      top: 18px;
      left: 28px;
      z-index: 1;
      width: 30px;
      height: 3px;
    }

    [data-star="3"] {
      top: 27px;
      left: 40px;
      z-index: 0;
      width: 30px;
      height: 3px;
    }

    /* Hidden stars (visible in dark mode) */
    [data-star="4"],
    [data-star="5"],
    [data-star="6"] {
      opacity: 0;
    }

    [data-star="4"] {
      top: 16px;
      left: 11px;
      z-index: 0;
      width: 2px;
      height: 2px;
      transform: translate3d(3px, 0, 0);
    }

    [data-star="5"] {
      top: 32px;
      left: 17px;
      z-index: 0;
      width: 3px;
      height: 3px;
      transform: translate3d(3px, 0, 0);
    }

    [data-star="6"] {
      top: 36px;
      left: 28px;
      z-index: 0;
      width: 2px;
      height: 2px;
      transform: translate3d(3px, 0, 0);
    }
  }
}

/* State layer: Checked/Dark mode states */
@layer toggle.state {
  @scope ([data-component="toggle-dark-mode"]) {
    /* Track background change */
    input:checked + [data-toggle-track] {
      background-color: #749dd6;
    }

    input:checked + [data-toggle-track]::before {
      color: #749ed7;
    }

    input:checked + [data-toggle-track]::after {
      color: #ffffff;
    }

    /* Handler transforms to moon */
    input:checked + [data-toggle-track] [data-toggle-handler] {
      background-color: #ffe5b5;
      transform: translate3d(40px, 0, 0) rotate(0);
    }

    /* Craters become visible */
    input:checked + [data-toggle-track] [data-crater] {
      opacity: 1;
    }

    /* Clouds shrink to stars */
    input:checked + [data-toggle-track] [data-star="1"] {
      width: 2px;
      height: 2px;
    }

    input:checked + [data-toggle-track] [data-star="2"] {
      width: 4px;
      height: 4px;
      transform: translate3d(-5px, 0, 0);
    }

    input:checked + [data-toggle-track] [data-star="3"] {
      width: 2px;
      height: 2px;
      transform: translate3d(-7px, 0, 0);
    }

    /* Additional stars appear */
    input:checked + [data-toggle-track] [data-star="4"],
    input:checked + [data-toggle-track] [data-star="5"],
    input:checked + [data-toggle-track] [data-star="6"] {
      opacity: 1;
      transform: translate3d(0, 0, 0);
    }
  }
}

/* Animation layer: Spring-based transitions using Motion's linear() easing */
/* @see https://motion.dev/tutorials/react-css-spring */
@layer toggle.animation {
  @scope ([data-component="toggle-dark-mode"]) {
    /* Track transition - gentle spring for smooth color change */
    [data-toggle-track] {
      transition: background-color var(--spring-gentle);
    }

    /* Handler bounce transition - bouncy spring for playful feel */
    [data-toggle-handler] {
      transition: 
        transform var(--spring-bouncy),
        background-color var(--spring-default);
    }

    /* Crater fade - snappy spring for quick appearance */
    [data-crater] {
      transition: opacity var(--spring-snappy);
    }

    /* Star/cloud morph transitions - default spring */
    [data-star] {
      transition: all var(--spring-default);
    }

    [data-star="4"],
    [data-star="5"],
    [data-star="6"] {
      transition: all var(--spring-default);
      transition-delay: 0ms;
    }

    /* Staggered star appearance in dark mode */
    input:checked + [data-toggle-track] [data-star="4"] {
      transition: all var(--spring-default);
      transition-delay: 150ms;
    }

    input:checked + [data-toggle-track] [data-star="5"] {
      transition: all var(--spring-default);
      transition-delay: 250ms;
    }

    input:checked + [data-toggle-track] [data-star="6"] {
      transition: all var(--spring-default);
      transition-delay: 350ms;
    }
  }

  /* Respect reduced motion preference */
  @media (prefers-reduced-motion: reduce) {
    @scope ([data-component="toggle-dark-mode"]) {
      [data-toggle-track],
      [data-toggle-handler],
      [data-crater],
      [data-star] {
        transition: none;
      }
    }
  }
}
